name: Rotate keys every month

on:
  schedule:
#    - cron: '0 0 1 * *'
    - cron: '*/15 * * * *'

jobs:
  rotate-keys:
    runs-on: ubuntu-latest

    steps:
    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_AZ_CREDENTIALS }}

    - name: Rotate keys
      run: |
        export group=warehouseautomationapi
        export api=warehouseAutomationAPI
        export fe=nvmwarehouseautomation
        export val=`az functionapp keys set  -n $api -g $group --key-type systemKeys --key-name k1 | jq '.value'| tr -d '"'`
        az webapp config appsettings set  --name $fe -g $group --settings HOSTKEY=$val


